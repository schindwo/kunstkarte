<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <title>Kunstkarte mit Markern</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- Mapbox CSS -->
  <link href="https://api.mapbox.com/mapbox-gl-js/v3.6.0/mapbox-gl.css" rel="stylesheet" />

  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 10px;
    }
    #map {
      width: 100%;
      height: 300px;
      border: 1px solid #ccc;
      margin-top: 20px;
    }
    img {
      max-width: 150px;
      margin-top: 5px;
    }
  </style>
</head>
<body>

<h1>ğŸ¨ Kunstkarte mit Markern</h1>

<input type="file" accept="image/*" capture="environment" id="fotoInput">
<img id="fotoVorschau" style="display:none;">
<br><br>
<button onclick="speichern()">ğŸ“ Kunstwerk speichern</button>

<div id="map"></div>

<!-- Mapbox JS -->
<script src="https://api.mapbox.com/mapbox-gl-js/v3.6.0/mapbox-gl.js"></script>

<script>
  // --- Map Setup ---
  mapboxgl.accessToken = 'pk.eyJ1Ijoic2NoaW5kd28iLCJhIjoiY21rOXFwOGp5MWl5OTNncXNrMmtmZzF4cyJ9.c6slgBjef31enlBqIw0gmQ';
  const map = new mapboxgl.Map({
    container: 'map',
    style: 'mapbox://styles/mapbox/streets-v12',
    center: [10, 51],
    zoom: 5
  });

  // --- Globale Variablen ---
  let aktuellesFoto = null;
  let kunstwerke = [];

  const fotoInput = document.getElementById("fotoInput");
  const fotoVorschau = document.getElementById("fotoVorschau");

  // --- Foto-Vorschau ---
  fotoInput.addEventListener("change", (event) => {
    const file = event.target.files[0];
    if (!file) return;

    aktuellesFoto = file;
    const reader = new FileReader();
    reader.onload = () => {
      fotoVorschau.src = reader.result;
      fotoVorschau.style.display = "block";
    };
    reader.readAsDataURL(file);
  });

  // --- Standort abrufen ---
  function getStandort(callback) {
    if (!navigator.geolocation) {
      alert("GPS wird nicht unterstÃ¼tzt");
      return;
    }

    navigator.geolocation.getCurrentPosition(
      (position) => {
        callback({
          lat: position.coords.latitude,
          lon: position.coords.longitude
        });
      },
      () => {
        alert("Standort konnte nicht ermittelt werden");
      }
    );
  }

  // --- Kunstwerk speichern ---
  function speichern() {
    if (!aktuellesFoto) {
      alert("Bitte zuerst ein Foto auswÃ¤hlen");
      return;
    }

    getStandort((standort) => {
      const kunstwerk = {
        foto: fotoVorschau.src,
        standort: standort,
        zeit: new Date().toLocaleString()
      };

      kunstwerke.push(kunstwerk);

      // --- Marker auf Map ---
      const popup = new mapboxgl.Popup({ offset: 25 })
        .setHTML(`<img src="${kunstwerk.foto}" alt="Kunstwerk"><br>${kunstwerk.zeit}`);

      new mapboxgl.Marker()
        .setLngLat([standort.lon, standort.lat])
        .setPopup(popup)
        .addTo(map);

      // --- Karte auf neues Kunstwerk zentrieren ---
      map.flyTo({ center: [standort.lon, standort.lat], zoom: 14 });

      alert("Kunstwerk gespeichert und Marker hinzugefÃ¼gt!");
    });
  }
</script>

</body>
</html>
